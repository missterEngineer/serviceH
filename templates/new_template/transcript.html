{% extends "new_template/base.html" %}
{% block title %}
Transcribir
{% endblock title %}
{% block style %}
<link rel="stylesheet" href="/static/css/transcriptv0.0.2.css">
<link rel="stylesheet" href="/static/css/loader.css">
{% endblock style %}
{% block content %}
<a href="/" class="back">
    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="20px" height="20px">
        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
        <g id="SVGRepo_iconCarrier">
            <path
                d="M16.1795 3.26875C15.7889 2.87823 15.1558 2.87823 14.7652 3.26875L8.12078 9.91322C6.94952 11.0845 6.94916 12.9833 8.11996 14.155L14.6903 20.7304C15.0808 21.121 15.714 21.121 16.1045 20.7304C16.495 20.3399 16.495 19.7067 16.1045 19.3162L9.53246 12.7442C9.14194 12.3536 9.14194 11.7205 9.53246 11.33L16.1795 4.68297C16.57 4.29244 16.57 3.65928 16.1795 3.26875Z"
                fill="#FFFFFF"></path>
        </g>
    </svg>
    <span>Volver</span>
</a>
<div class="card">
    <div class="card-head">
        <p class="audio-txt">Audio grabado: <a id="audio-link" href="/download/{{audio}}" download>{{audio}}</a></p>
        <div>
            <button class="btn" id="startBtn" hidden onclick="start_transcript(false)">Transcribir</button>
            <button class="btn" id="startSpeakerBtn" hidden onclick="start_transcript(true)">Transcribir(P)</button>
        </div>
        <div>
            <a href="#" class="delete" onclick="del_file()">
                <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <mask id="mask0_38_809" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="25"
                        height="24">
                        <rect x="0.984375" width="24" height="24" fill="#D9D9D9" />
                    </mask>
                    <g mask="url(#mask0_38_809)">
                        <path
                            d="M7.98438 21C7.43438 21 6.96354 20.8042 6.57187 20.4125C6.18021 20.0208 5.98438 19.55 5.98438 19V6H4.98438V4H9.98438V3H15.9844V4H20.9844V6H19.9844V19C19.9844 19.55 19.7885 20.0208 19.3969 20.4125C19.0052 20.8042 18.5344 21 17.9844 21H7.98438ZM17.9844 6H7.98438V19H17.9844V6ZM9.98438 17H11.9844V8H9.98438V17ZM13.9844 17H15.9844V8H13.9844V17Z"
                            fill="#ACE5C6" />
                    </g>
                </svg>
            </a>
        </div>
    </div>
    <div class="card-body">
        <div id="empty">
            <img src="/static/images/transcript_empty.svg" alt="Avatar persona">
            <p>Para aprovechar al máximo la IA, transcribe primero tu audio antes de crear tu prompt</p>
            <button class="btn" onclick="start_transcript(false)">Transcribir</button>
            <a onclick="start_transcript(true)">Transcribir con participantes</a>
        </div>
        <h4 id="transcript-title" hidden>Transcripción</h4>
        <div id="transcript-content">
        </div>
        <div class="gpt-divider" hidden>
            <div class="line" ></div>
            <span>Finaliza Transcripción, Ahora pregúntale a chatGPT</span>
        </div>
        <div id="gpt-content">
        </div>
    </div>
    <div class="card-footer blocked">
        <div id="othersBtn">
            <a class="saved-prompts">Seleccionar prompt</a> &nbsp; | &nbsp; 
            <a class="saving-prompts" onclick="save_current_prompt()">
                Guardar
                <svg width="20" height="20" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <mask id="mask0_245_3433" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="16" height="16">
                    <rect width="16" height="16" fill="currentColor"/>
                    </mask>
                    <g mask="url(#mask0_245_3433)">
                    <path d="M14 4.66667V12.6667C14 13.0333 13.8694 13.3472 13.6083 13.6083C13.3472 13.8694 13.0333 14 12.6667 14H3.33333C2.96667 14 2.65278 13.8694 2.39167 13.6083C2.13056 13.3472 2 13.0333 2 12.6667V3.33333C2 2.96667 2.13056 2.65278 2.39167 2.39167C2.65278 2.13056 2.96667 2 3.33333 2H11.3333L14 4.66667ZM12.6667 5.23333L10.7667 3.33333H3.33333V12.6667H12.6667V5.23333ZM8 12C8.55556 12 9.02778 11.8056 9.41667 11.4167C9.80556 11.0278 10 10.5556 10 10C10 9.44444 9.80556 8.97222 9.41667 8.58333C9.02778 8.19444 8.55556 8 8 8C7.44444 8 6.97222 8.19444 6.58333 8.58333C6.19444 8.97222 6 9.44444 6 10C6 10.5556 6.19444 11.0278 6.58333 11.4167C6.97222 11.8056 7.44444 12 8 12ZM4 6.66667H10V4H4V6.66667Z" fill="currentColor"/>
                    </g>
                </svg> 
            </a>
            <script>
                function save_current_prompt(){
                    document.querySelector("dialog textarea").value = document.getElementById("questionTxt").value;
                    open_modal("modal-save");
                }
            </script>
            
        </div>
        <textarea name="" id="questionTxt"
            placeholder="Escribe una pregunta..." disabled>Haz un resumen de está conversación:</textarea>
        <a class="send" href="#" id="sendGPT">
            <svg width="25" height="24" viewBox="0 0 25 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"
                class="gpt-send">
                <mask id="mask0_38_875" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="25"
                    height="24">
                    <rect x="0.984375" width="24" height="24" fill="currentColor" />
                </mask>
                <g mask="url(#mask0_38_875)">
                    <path
                        d="M3.48437 4.5L4.48438 3.5L22.4844 11.5L4.48437 19.5L3.48437 18.5L6.48437 11.5L3.48437 4.5ZM6.58437 6.6L8.68437 11.5L6.58437 16.4L17.5844 11.5L6.58437 6.6Z"
                        fill="currentColor" />
                </g>
            </svg>
            <svg width="36" height="36" fill="#fff" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
                class="gpt-spinner hide">
                <style>
                    .spinner_P7sC {
                        transform-origin: center;
                        animation: spinner_svv2 .75s infinite
                    }

                    @keyframes spinner_svv2 {
                        100% {
                            transform: rotate(360deg)
                        }
                    }
                </style>
                <path
                    d="M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z"
                    class="spinner_P7sC" />
            </svg>
        </a>
    </div>
</div>
{% endblock content %}

{% block modal %}
<dialog id="modal-save">
    <form>
        <h2>Guardar Prompt</h2>
        <label for="title">Titulo</label>
        <input type="text" id="title" name="title" class="styled" placeholder="Coloca un titulo al Prompt">
        <label for="prompt">Prompt</label>
        <textarea id="prompt" name="prompt"></textarea>
        <button type="button" class="btn" onclick="close_modal('modal-save')">Cancelar</button>
        <button type="button" class="btn success" onclick="save_prompt()">Guardar</button>
    </form>
</dialog>
<style>
    #modal-prompts{
        padding: 15px 10px;
        background-color: #002E2E;
    }
    #modal-prompts h2{
        margin: 0 0 20px 0;
        font-size: 20px;
        text-align: left;
        padding-left: 10px;
    }
    .close-modal-prompt{
        right: 10px;
        top: 10px;
        position: absolute;
        color: white;
        text-decoration: none;
        font-size: 14px;
    }
    .close-modal-prompt svg{
        top: 4px;
        position: relative;
    }
    .close-modal-prompt:hover{
        color: rgba(255, 255, 255, 0.5);
    }
    summary {
        list-style-type: none;
        cursor: pointer;
        position: relative;
        display: flex;
        align-items: center;
    }
    summary::webkit-details-marker {
        display: none 
    }
    summary h3{
        font-size: 18px;
        width: calc(100% - 160px);
        display: inline-block;
        
    }
    details{
        max-width: 85vw;
        width: 760px;
        color: #FAFAFA;
    }
    summary button{
        border-radius: 8px;
        background: #001919;    
        padding: 10px 15px; 
        color: #FFF;
        border: none;
        font-size: 14px;
        height: 34px;
    }
    summary button:hover{
        cursor: pointer;
        background: #00CF83; 
        color: #004949;
    }
    .prompt{
        border-radius: 8px;
    background: rgba(0, 28, 28, 0.50); 
    }
    details[open] .prompt-arrow{
        transform: rotate(180deg) ;
    }

    details p{
        font-size: 14px;
        color: rgba(255, 255, 255, 0.75); 
    }
    details span{
        color: var(--cta-primary-bg-cta-primary, #00CF83); 
    }
    .send{
        z-index: 3;
    }
    @media (max-width:480px) {
        .gpt-divider span{
            padding: 7px 5px;
            font-size: 12px;
        }
        #othersBtn{
            width: 260px;
        }
        textarea{
            z-index: 2;
            position: relative;
        }
    }
</style>
<dialog id="modal-prompts" class="prompts">
        
        <a href="javascript:void(0)" class="close-modal-prompt" onclick="close_modal('modal-prompts')">
            Cerrar
            <svg width="18" height="18" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                <mask id="mask0_299_682" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="16" height="16">
                <rect width="16" height="16" fill="#D9D9D9"/>
                </mask>
                <g mask="url(#mask0_299_682)">
                <path d="M4.26634 12.6668L3.33301 11.7335L7.06634 8.00016L3.33301 4.26683L4.26634 3.3335L7.99967 7.06683L11.733 3.3335L12.6663 4.26683L8.93301 8.00016L12.6663 11.7335L11.733 12.6668L7.99967 8.9335L4.26634 12.6668Z" fill="currentColor"/>
                </g>
            </svg> 
        </a> 
        <h2>Historial de prompts</h2>
        {% for prompt in prompts  %}
        <div class="prompt" data-id="{{ prompt.id }}">
                <details class="prompt-content">
                    <summary>
                        <h3>{{ prompt.title }}</h3> 
                        {% if session.user == 'prueba' %} 
                        <a href="#" class="ico-link delete-prompt" onclick="del_prompt(this)">
                            <img src="/static/images/delete.svg" alt="Lápiz">
                        </a>
                        {% endif %}
                        <button onclick="show_prompt(this)">Usar prompt</button> 
                        <img class="prompt-arrow" src="/static/images/arrow_up.svg" alt="Flecha hacia arriba">
                    </summary>
                    <p><span>Prompt: </span>{{ prompt.prompt }}</p> 
                </details>      

            
           
            <!-- 
            <a href="#" class="ico-link " onclick="edit_prompt(this)">
                <img src="/static/images/edit.svg" alt="Recipiente de basura">
            </a>
            -->
        </div>
        {% endfor %}

</dialog>
<dialog id="modal-loader">
    <div>
        <div class="loader-box">
            <span class="loader"></span>
        </div>
        <h2>Transcribiendo audio</h2>
    </div>
</dialog>   
{% endblock %}

{% block script %}
<script src="/static/js/socket.io.js"></script>
<script src="/static/js/socket.config.js"></script>
<script src="/static/js/transcriptv0.0.2.js"></script>
{% endblock script %}