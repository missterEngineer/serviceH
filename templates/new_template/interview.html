{% extends "new_template/base.html" %}
{% block title %}
  Crear Usuario
{% endblock title %}
{% block style %}
    <style>
        .title{
            text-align: center;
        }
        form{
            margin: 0 auto;
        }
        .login{
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            position: relative;
            max-width: 100vw;
            padding-bottom: 20px;
            width: 500px;
            background: #002424;
        }
        input{
            margin: 10px 0 20px 0;
        }
        @media (min-width:480px) and (max-width:700px) {
            input{
            width: 40vw;
            }
            button, label{
            margin: 0
            }
        }

    </style>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

{% endblock style %}
{% block content %}
<a href="/" class="back">
    <img src="/static/images/back.svg" alt="volver">
    <span>Volver</span>
</a>
<form action="" class="card login" id="new_user_form">
    <h1 class="title">Añadir usuario</h1>
    <label for="user">Usuario</label>
    <input name="user" class="styled" type="text" id="user" placeholder="Ingresa un nombre de usuario">
    <label for="password">Contraseña</label>
    <input name="password" class="styled" type="password" id="password" placeholder="Ingresa una contraseña fuerte">
    <button type="button" id="submit" class="btn success">Guardar</button>
</form>
{% endblock content %}
{% block script %}
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

<script>
    function toast(text, color) {
        Toastify({
            text: text,
            duration: 5000,
            close: true,
            gravity: "top",
            position: "right",
            stopOnFocus: true,
            style: {
                background: color
            },
            onClick: function () {} // Callback after click
        }).showToast();
    }

    document.getElementById("submit").onclick = async ()=>{
        const new_user_form = document.getElementById("new_user_form")
        const data = new FormData(new_user_form)
        const response = await fetch("/create_user",{
            method: "POST",
            body: data
        })
        const result = await response.json();
        if('error' in result){
            toast(result['error'], "#592323")
        }else{
            toast("Usuario creado exitosamente", "#0e8843")
        }
    }
</script>

{% endblock script %}