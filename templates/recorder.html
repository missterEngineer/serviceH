{% extends "base.html" %}
{% block head %}
    <style>
        .record {
            margin: 0 5px;

        }

        .record img {
            width: 50px
        }
        h1{
            font-size: 30px;
        }
        #stop{
            display: none;
        }
    </style>
{% endblock head %}
{% block content %}
    <a href="/" class="back expand" title="back"><img src="/static/back.png" alt="back"></a>
    <h1>Grabar audio</h1>
    <button id="start" class="record expand" title="play"><img src="/static/play.png" alt="play"></button>
    <button id="stop" class="record expand" title="stop"><img src="/static/stop.png" alt="stop"></button>
{% endblock content %}

{% block javascript%}
    <script src="/static/js/socket.io.js"></script>
    <script src="/static/js/socket.config.js"></script>
    <script src="/static/js/recordv.0.0.1.js"></script>
    <script>
        let start = document.getElementById('start'),
            stopBtn = document.getElementById('stop'),
            mediaRecorder,
            micRecorder,
            speaker_stream,
            mic_stream

        start.addEventListener('click', async function () {
            socket.connect();
            start.style.display = 'none'
            stopBtn.style.display = 'inline-block'
            speaker_stream = await recordScreen();
            mic_stream = await recordMic();
            mediaRecorder = createRecorder(speaker_stream, 'record');
            micRecorder = createRecorder(mic_stream, 'recordMic')
        })

        stopBtn.addEventListener('click', function () {
            stopRecord(mediaRecorder)
            stopRecord(micRecorder)
            socket.emit('message', 'stop');
            stopBtn.style.display = 'none'
            start.style.display = 'inline-block'
        })
        function stopRecord(recorder){
            if(recorder.state === "recording"){
                recorder.fromBtn = true
                recorder.stop();
            }
        }
    </script>
{% endblock javascript%}