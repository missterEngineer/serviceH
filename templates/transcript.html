{% extends "base.html" %}
{% block head %}
    <link rel="stylesheet" href="/static/transcript.css">
{% endblock head %}
{% block content %}
    <a href="/" class="back expand" title="back"><img src="/static/back.png" alt="back"></a>
    <h1>Transcripción en tiempo real</h1>
    <div class="transcript">
        <p id="audioName"></p>
        <button type="button" class="expand" id="startBtn">Empezar</button>
     
    
        <textarea id="transcriptTxt"></textarea>
        <footer>
            <label for="questionTxt">Pregunta a chatGPT</label>
            <textarea id="questionTxt">Hola! Te voy a dar la siguiente conversación para que me digas el tema que tratan y los puntos principales:</textarea>
            <button class="expand" id="askBtn">Preguntar</button>
        </footer>    
    </div>
    <dialog id="gptModal">
        <a class="back expand"  title="close Modal" id="closeModalBtn" ><img src="/static/close.png" alt="close"></a>
        <h2>Respuesta</h2>
        <article id="gptResponse">
            <p>Generando...</p>
        </article>
    </dialog>

{% endblock content %}
{% block javascript%}
<script>
    // Converting audio to text
    const startBtn = document.getElementById("startBtn"),
    socket = io(),
    transcriptTxt = document.getElementById("transcriptTxt");
    startBtn.addEventListener("click", ()=>{
        socket.emit('startRealTime', {
            model: 'small',
            audio: audio
        });
        startBtn.disabled = true
        startBtn.innerText = "Cargando..."
        startBtn.classList.remove("expand")
    })

    socket.on('response', msg => {
        transcriptTxt.value += msg  +"\n"
    });
    socket.on('end',()=>{
        startBtn.disabled = false
        startBtn.innerText = "Empezar"
        startBtn.classList.add("expand")
    })

    // Modal config
    const gptModal = document.getElementById("gptModal"),
    askBtn = document.getElementById("askBtn"),
    closeModalBtn = document.getElementById("closeModalBtn"),
    questionTxt = document.getElementById("questionTxt"),
    gptResponse = document.getElementById("gptResponse");

    askBtn.addEventListener('click',()=> gptModal.showModal())
    closeModalBtn.addEventListener('click',()=> gptModal.close())

    // Using ChatGPT
    askBtn.addEventListener('click', ()=>{
        gptResponse.innerHTML = '<p>Generando...</p>';
        socket.emit('startChat', {
            conversation: transcriptTxt.value,
            question: questionTxt.value
        });
    })
    socket.on('chatResponse', msg => {
        gptResponse.innerHTML += msg
    })
</script>
{% endblock javascript%}